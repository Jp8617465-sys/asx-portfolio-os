#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."
echo "âš ï¸  MANDATORY: Cannot commit without passing all checks"
echo ""

cd frontend

# 1. Type checking
echo "ğŸ“ TypeScript type checking..."
npm run type-check || {
  echo "âŒ TypeScript errors detected. Fix them before committing."
  exit 1
}

# 2. Linting
echo "ğŸ§¹ ESLint checking..."
npm run lint || {
  echo "âŒ ESLint errors detected. Fix them before committing."
  exit 1
}

# 3. Format checking
echo "ğŸ’… Code formatting check..."
npm run format:check || {
  echo "âŒ Code formatting issues detected."
  echo "ğŸ’¡ Run 'npm run format' to auto-fix."
  exit 1
}

# 4. Run tests with 80% coverage requirement
echo "ğŸ§ª Running tests (80% coverage required)..."
npm run test:ci || {
  echo "âŒ Tests failed or coverage below 80%."
  echo "ğŸ’¡ Run 'npm run test:coverage' to see coverage report."
  exit 1
}

echo ""
echo "âœ… All pre-commit checks passed!"
echo "âœ… Coverage meets 80% threshold"
echo "âœ… Ready to commit"
