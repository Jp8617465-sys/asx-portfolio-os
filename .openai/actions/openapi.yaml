openapi: 3.1.0
info:
  title: ASX Portfolio OS
  version: 0.4.0
  description: >
    Provides portfolio intelligence, model performance summaries, drift analytics,
    and ML signal insights for the ASX Portfolio Operating System.
servers:
  - url: https://tackle-spectacular-trace-horn.trycloudflare.com
    description: Cloudflare public API gateway
paths:
  /model/status/summary:
    get:
      summary: Get model status and latest metrics
      description: Returns latest model version, metrics, signal count, and drift summary.
      parameters:
        - name: model
          in: query
          required: true
          schema:
            type: string
            example: model_a_ml
      responses:
        '200':
          description: Model summary
          content:
            application/json:
              schema:
                type: object
                properties:
                  last_run:
                    type: string
                  sharpe:
                    type: number
                  cagr:
                    type: number
                  drift_status:
                    type: string
                  signal_count:
                    type: integer
  /dashboard/model_a_v1_1:
    get:
      summary: Get detailed portfolio dashboard
      description: Returns holdings, rankings, weights, and metrics for a given date.
      parameters:
        - name: as_of
          in: query
          required: true
          schema:
            type: string
            example: 2026-01-12
      responses:
        '200':
          description: Dashboard data
          content:
            application/json:
              schema:
                type: object
                properties:
                  as_of:
                    type: string
                  summary:
                    type: object
                  targets:
                    type: array
                    items:
                      type: object
  /drift/summary:
    get:
      summary: Get drift summary
      description: Returns model drift metrics for the last run and comparison to baseline.
      parameters:
        - name: model
          in: query
          required: true
          schema:
            type: string
            example: model_a_ml
      responses:
        '200':
          description: Drift summary data
          content:
            application/json:
              schema:
                type: object
                properties:
                  drift_mean:
                    type: number
                  drift_std:
                    type: number
                  features_drifting:
                    type: integer
  /model/compare:
    get:
      summary: Compare two model runs
      description: Returns metric deltas between two model registry entries.
      parameters:
        - name: model
          in: query
          required: false
          schema:
            type: string
            example: model_a_ml
        - name: left_version
          in: query
          required: false
          schema:
            type: string
            example: v1_1
        - name: right_version
          in: query
          required: false
          schema:
            type: string
            example: v1_2
      responses:
        '200':
          description: Model compare payload
          content:
            application/json:
              schema:
                type: object
                properties:
                  left:
                    type: object
                  right:
                    type: object
                  delta:
                    type: object
  /signals/live:
    get:
      summary: Get latest ML signals
      description: Returns top ranked ML signals for the latest or specified date.
      parameters:
        - name: model
          in: query
          required: false
          schema:
            type: string
            example: model_a_ml
        - name: as_of
          in: query
          required: false
          schema:
            type: string
            example: 2026-01-12
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            example: 20
      responses:
        '200':
          description: Signals payload
          content:
            application/json:
              schema:
                type: object
                properties:
                  as_of:
                    type: string
                  count:
                    type: integer
                  signals:
                    type: array
                    items:
                      type: object
  /property/valuation:
    post:
      summary: Run property valuation
      description: Computes property valuation summary for a region.
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                region:
                  type: string
                horizon_months:
                  type: integer
                persist:
                  type: boolean
      responses:
        '200':
          description: Property valuation summary
          content:
            application/json:
              schema:
                type: object
  /loan/simulate:
    post:
      summary: Simulate loan amortization
      description: Returns amortization summary for a loan.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [principal, annual_rate, years]
              properties:
                principal:
                  type: number
                annual_rate:
                  type: number
                years:
                  type: integer
                extra_payment:
                  type: number
                persist:
                  type: boolean
      responses:
        '200':
          description: Loan simulation response
          content:
            application/json:
              schema:
                type: object
security:
  - ApiKeyAuth: []
components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: x-api-key
