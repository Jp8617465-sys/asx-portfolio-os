#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Load user environment to get npm in PATH
[ -f ~/.zshrc ] && . ~/.zshrc
[ -f ~/.bashrc ] && . ~/.bashrc
[ -f ~/.bash_profile ] && . ~/.bash_profile

# Add common npm/node paths
export PATH="/usr/local/bin:/opt/homebrew/bin:$HOME/.nvm/versions/node/$(ls -t $HOME/.nvm/versions/node 2>/dev/null | head -1)/bin:$PATH"

echo "ğŸš€ Running pre-push checks..."
echo "âš ï¸  MANDATORY: Cannot push without successful build"
echo ""

cd frontend

# 1. Run full test suite
echo "ğŸ§ª Running complete test suite..."
npm run test:ci || {
  echo "âŒ Test suite failed."
  echo "ğŸ’¡ All tests must pass before pushing."
  exit 1
}

# 2. Production build verification
echo "ğŸ—ï¸  Building production bundle..."
npm run build || {
  echo "âŒ Production build failed."
  echo "ğŸ’¡ Fix build errors before pushing."
  exit 1
}

echo ""
echo "âœ… All pre-push checks passed!"
echo "âœ… Production build successful"
echo "âœ… Safe to push to remote"
